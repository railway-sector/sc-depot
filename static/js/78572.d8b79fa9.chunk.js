"use strict";(self.webpackChunksc_depot=self.webpackChunksc_depot||[]).push([[78572],{31516:(t,e,n)=>{n.d(e,{F:()=>i});n(18690),n(53084);var r=n(18288),o=n(48718);n(42052),n(72027);function i(t,e,n){if(null==(null===t||void 0===t?void 0:t.timeInfo))return null;const{datesInUnknownTimezone:i=!1,timeOffset:l,useViewTime:a}=t;let s=t.timeExtent;i&&(s=function(t){if(!t)return t;const{start:e,end:n}=t;return new o.T({start:null!=e?(0,r.S1)(e,e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,r.S1)(n,n.getTimezoneOffset(),"minutes"):n})}(s));let u=a?e&&s?e.intersection(s):e||s:s;return!u||u.isEmpty||u.isAllTime?u:(l&&(u=u.offset(-l.value,l.unit)),i&&(u=function(t){if(!t)return t;const{start:e,end:n}=t;return new o.T({start:null!=e?(0,r.S1)(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=n?(0,r.S1)(n,-n.getTimezoneOffset(),"minutes"):n})}(u)),u.equals(n)?n:u)}},46533:(t,e,n)=>{n.d(e,{CW:()=>f,DE:()=>d,pH:()=>y,qH:()=>m});var r=n(81806),o=n(76460),i=n(15941),l=n(50346),a=n(47249),s=n(76797),u=n(80963);const c=()=>o.A.getLogger("esri.views.2d.engine.flow.dataUtils"),h=10;async function f(t,e,n,o){const i=performance.now(),s=d(e,n),u=performance.now(),f=m(e,s,n.width,n.height),p=performance.now(),g=function(t,e){const n=new a.A,r=t.reduce(((t,e)=>t+e.length),0),o=new Float32Array(4*r),i=new Array(t.length);let l=0,s=0;for(const a of t){const t=l;for(const e of a)o[4*l]=e.x,o[4*l+1]=e.y,o[4*l+2]=e.t,o[4*l+3]=e.speed,l++;i[s++]={startVertex:t,numberOfVertices:a.length,totalTime:a[a.length-1].t,timeSeed:e?n.getFloat():0}}return{lineVertices:o,lineDescriptors:i}}(f,!0),y=performance.now(),w="Streamlines"===t?function(t,e){const n=9,{lineVertices:r,lineDescriptors:o}=t;let i=0,l=0;for(const d of o)i+=2*d.numberOfVertices,l+=6*(d.numberOfVertices-1);const a=new Float32Array(i*n),s=new Uint32Array(l);let u=0,c=0;function h(){s[c++]=u-2,s[c++]=u,s[c++]=u-1,s[c++]=u,s[c++]=u+1,s[c++]=u-1}function f(t,e,r,o,i,l,s,c){const h=u*n;let f=0;a[h+f++]=t,a[h+f++]=e,a[h+f++]=1,a[h+f++]=r,a[h+f++]=l,a[h+f++]=s,a[h+f++]=o/2,a[h+f++]=i/2,a[h+f++]=c,u++,a[h+f++]=t,a[h+f++]=e,a[h+f++]=-1,a[h+f++]=r,a[h+f++]=l,a[h+f++]=s,a[h+f++]=-o/2,a[h+f++]=-i/2,a[h+f++]=c,u++}for(const d of o){const{totalTime:t,timeSeed:n}=d;let o=null,i=null,l=null,a=null,s=null,u=null;for(let c=0;c<d.numberOfVertices;c++){const p=r[4*(d.startVertex+c)],m=r[4*(d.startVertex+c)+1],g=r[4*(d.startVertex+c)+2],y=r[4*(d.startVertex+c)+3];let w=null,v=null,_=null,x=null;if(c>0){w=p-o,v=m-i;const r=Math.sqrt(w*w+v*v);if(w/=r,v/=r,c>1){let t=w+s,n=v+u;const r=Math.sqrt(t*t+n*n);t/=r,n/=r;const o=Math.min(1/(t*w+n*v),e);t*=o,n*=o,_=-n,x=t}else _=-v,x=w;null!==_&&null!==x&&(f(o,i,l,_,x,t,n,y),h())}o=p,i=m,l=g,s=w,u=v,a=y}f(o,i,l,-u,s,t,n,a)}return{vertexData:a,indexData:s}}(g,h):function(t){const e=16,n=1,r=2,{lineVertices:o,lineDescriptors:i}=t;let l=0,a=0;for(const k of i){const t=k.numberOfVertices-1;l+=4*t*2,a+=6*t*2}const s=new Float32Array(l*e),u=new Uint32Array(a);let c,h,f,d,p,m,g,y,w,v,_,x,b,S,M=0,A=0;function T(){u[A++]=M-8,u[A++]=M-7,u[A++]=M-6,u[A++]=M-7,u[A++]=M-5,u[A++]=M-6,u[A++]=M-4,u[A++]=M-3,u[A++]=M-2,u[A++]=M-3,u[A++]=M-1,u[A++]=M-2}function D(t,o,i,l,a,u,c,h,f,d,p,m,g,y){const w=M*e;let v=0;for(const e of[n,r])for(const n of[1,2,3,4])s[w+v++]=t,s[w+v++]=o,s[w+v++]=i,s[w+v++]=l,s[w+v++]=c,s[w+v++]=h,s[w+v++]=f,s[w+v++]=d,s[w+v++]=e,s[w+v++]=n,s[w+v++]=g,s[w+v++]=y,s[w+v++]=a/2,s[w+v++]=u/2,s[w+v++]=p/2,s[w+v++]=m/2,M++}function I(t,e){let n=w+_,r=v+x;const o=Math.sqrt(n*n+r*r);n/=o,r/=o;const i=w*n+v*r;n/=i,r/=i;let l=_+b,a=x+S;const s=Math.sqrt(l*l+a*a);l/=s,a/=s;const u=_*l+x*a;l/=u,a/=u,D(c,h,f,d,-r,n,p,m,g,y,-a,l,t,e),T()}function F(t,e,n,r,o,i){if(w=_,v=x,_=b,x=S,null==w&&null==v&&(w=_,v=x),null!=p&&null!=m){b=t-p,S=e-m;const n=Math.sqrt(b*b+S*S);b/=n,S/=n}null!=w&&null!=v&&I(o,i),c=p,h=m,f=g,d=y,p=t,m=e,g=n,y=r}function L(t,e){w=_,v=x,_=b,x=S,null==w&&null==v&&(w=_,v=x),null!=w&&null!=v&&I(t,e)}for(const k of i){c=null,h=null,f=null,d=null,p=null,m=null,g=null,y=null,w=null,v=null,_=null,x=null,b=null,S=null;const{totalTime:t,timeSeed:e}=k;for(let n=0;n<k.numberOfVertices;n++)F(o[4*(k.startVertex+n)],o[4*(k.startVertex+n)+1],o[4*(k.startVertex+n)+2],o[4*(k.startVertex+n)+3],t,e);L(t,e)}return{vertexData:s,indexData:u}}(g),v=performance.now();return(0,r.A)("esri-2d-profiler")&&(c().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-i)),c().info("I.2","_getStreamlines (ms)",Math.round(p-u)),c().info("I.3","createAnimatedLinesData (ms)",Math.round(y-p)),c().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(v-y)),c().info("I.5","createFlowMesh (ms)",Math.round(v-i)),c().info("I.6","Mesh size (bytes)",w.vertexData.buffer.byteLength+w.indexData.buffer.byteLength)),await Promise.resolve(),(0,l.Te)(o),w}function d(t,e){const n=function(t,e,n,r){if(0===r)return t;const o=Math.round(3*r),i=new Array(2*o+1);let l=0;for(let u=-o;u<=o;u++){const t=Math.exp(-u*u/(r*r));i[u+o]=t,l+=t}for(let u=-o;u<=o;u++)i[u+o]/=l;const a=new Float32Array(t.length);for(let u=0;u<n;u++)for(let n=0;n<e;n++){let r=0,l=0;for(let a=-o;a<=o;a++){if(n+a<0||n+a>=e)continue;const s=i[a+o];r+=s*t[2*(u*e+(n+a))],l+=s*t[2*(u*e+(n+a))+1]}a[2*(u*e+n)]=r,a[2*(u*e+n)+1]=l}const s=new Float32Array(t.length);for(let u=0;u<e;u++)for(let t=0;t<n;t++){let r=0,l=0;for(let s=-o;s<=o;s++){if(t+s<0||t+s>=n)continue;const c=i[s+o];r+=c*a[2*((t+s)*e+u)],l+=c*a[2*((t+s)*e+u)+1]}s[2*(t*e+u)]=r,s[2*(t*e+u)+1]=l}return s}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,r)=>{const o=Math.floor(t),i=Math.floor(r);if(o<0||o>=e.width)return[0,0];if(i<0||i>=e.height)return[0,0];const l=t-o,a=r-i,s=o,u=i,c=o<e.width-1?o+1:o,h=i<e.height-1?i+1:i,f=n[2*(u*e.width+s)],d=n[2*(u*e.width+c)],p=n[2*(h*e.width+s)],m=n[2*(h*e.width+c)],g=n[2*(u*e.width+s)+1],y=n[2*(u*e.width+c)+1];return[(f*(1-a)+p*a)*(1-l)+(d*(1-a)+m*a)*l,(g*(1-a)+n[2*(h*e.width+s)+1]*a)*(1-l)+(y*(1-a)+n[2*(h*e.width+c)+1]*a)*l]}:(t,r)=>{const o=Math.round(t),i=Math.round(r);return o<0||o>=e.width||i<0||i>=e.height?[0,0]:[n[2*(i*e.width+o)],n[2*(i*e.width+o)+1]]}}function p(t,e,n,r,o,i,l,a,s){const u=[];let c=n,h=r,f=0,[d,p]=e(c,h);d*=t.velocityScale,p*=t.velocityScale;const m=Math.sqrt(d*d+p*p);let g,y;u.push({x:c,y:h,t:f,speed:m});for(let w=0;w<t.verticesPerLine;w++){let[n,r]=e(c,h);n*=t.velocityScale,r*=t.velocityScale;const d=Math.sqrt(n*n+r*r);if(d<t.minSpeedThreshold)return u;const p=n/d,m=r/d;if(c+=p*t.segmentLength,h+=m*t.segmentLength,f+=t.segmentLength/d,Math.acos(p*g+m*y)>t.maxTurnAngle)return u;if(t.collisions){const t=Math.round(c*s),e=Math.round(h*s);if(t<0||t>l-1||e<0||e>a-1)return u;const n=i[e*l+t];if(-1!==n&&n!==o)return u;i[e*l+t]=o}u.push({x:c,y:h,t:f,speed:d}),g=p,y=m}return u}function m(t,e,n,r){const o=[],i=new a.A,l=1/Math.max(t.lineCollisionWidth,1),s=Math.round(n*l),u=Math.round(r*l),c=new Int32Array(s*u);for(let a=0;a<c.length;a++)c[a]=-1;const h=[];for(let a=0;a<r;a+=t.lineSpacing)for(let e=0;e<n;e+=t.lineSpacing)h.push({x:e,y:a,sort:i.getFloat()});h.sort(((t,e)=>t.sort-e.sort));for(const{x:a,y:f}of h)if(i.getFloat()<t.density){const n=p(t,e,a,f,o.length,c,s,u,l);if(n.length<2)continue;o.push(n)}return o}function g(t,e){const n=e.pixels,{width:r,height:o}=e,l=new Float32Array(r*o*2),a=e.mask||new Uint8Array(r*o*2);if(e.mask||a.fill(255),"vector-uv"===t)for(let i=0;i<r*o;i++)l[2*i]=n[0][i],l[2*i+1]=-n[1][i];else if("vector-magdir"===t)for(let s=0;s<r*o;s++){const t=n[0][s],e=(0,i.kU)(n[1][s]),r=Math.cos(e-Math.PI/2),o=Math.sin(e-Math.PI/2);l[2*s]=r*t,l[2*s+1]=o*t}return{data:l,mask:a,width:r,height:o}}async function y(t,e,n,o,i,l){const a=performance.now(),h=(0,u.Vp)(e.spatialReference);if(!h){const s=await w(t,e,n,o,i,l);return(0,r.A)("esri-2d-profiler")&&c().info("I.7","loadImagery, early exit (ms)",Math.round(performance.now()-a)),(0,r.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",1),s}const[f,d]=h.valid,p=d-f,m=Math.ceil(e.width/p),g=e.width/m,y=Math.round(n/m);let v=e.xmin;const _=[],x=performance.now();for(let r=0;r<m;r++){const n=new s.A({xmin:v,xmax:v+g,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});_.push(w(t,n,y,o,i,l)),v+=g}const b=await Promise.all(_);(0,r.A)("esri-2d-profiler")&&c().info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-x)),(0,r.A)("esri-2d-profiler")&&c().info("I.9","Number of parts",b.length);const S={data:new Float32Array(n*o*2),mask:new Uint8Array(n*o),width:n,height:o};let M=0;for(const r of b){for(let t=0;t<r.height;t++)for(let e=0;e<r.width;e++)M+e>=n||(S.data[2*(t*n+M+e)]=r.data[2*(t*r.width+e)],S.data[2*(t*n+M+e)+1]=r.data[2*(t*r.width+e)+1],S.mask[t*n+M+e]=r.mask[t*r.width+e]);M+=r.width}return(0,r.A)("esri-2d-profiler")&&c().info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-a)),S}async function w(t,e,n,r,o,i){const l={requestProjectedLocalDirections:!0,signal:i};if(null!=o&&(l.timeExtent=o),"imagery"===t.type){var a;await t.load({signal:i});const o=await t.internalFetchImage(e,n,r,l);return null==(null===o||void 0===o||null===(a=o.pixelData)||void 0===a?void 0:a.pixelBlock)?{data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r}:g(t.rasterInfo.dataType,o.pixelData.pixelBlock)}await t.load({signal:i});const s=await t.fetchPixels(e,n,r,l);return null==(null===s||void 0===s?void 0:s.pixelBlock)?{data:new Float32Array(n*r*2),mask:new Uint8Array(n*r),width:n,height:r}:g(t.serviceRasterInfo.dataType,s.pixelBlock)}},66917:(t,e,n)=>{n.d(e,{EO:()=>f,Lu:()=>i,Sl:()=>m,UL:()=>c,YC:()=>s,hq:()=>o,l0:()=>a,oU:()=>u,r$:()=>d,vG:()=>p});var r=n(76931);n(63919),n(85827);function o(t){const e=i(s(t)),n=e,o=Math.max(e/2,5),l=Math.round((0,r.Lz)(t.maxPathLength)/o)+1,{density:a}=t;return{smoothing:(0,r.Lz)(t.smoothing),interpolate:!0,velocityScale:"flow-from"===t.flowRepresentation?1:-1,verticesPerLine:l,minSpeedThreshold:.001,segmentLength:o,maxTurnAngle:1,collisions:!0,lineCollisionWidth:n,lineSpacing:10,density:a}}function i(t){return"constant"===t.kind?t.value[0]:t.values[t.values.length-1]}function l(t){const e=t.toRgba();return[e[0]/255,e[1]/255,e[2]/255,e[3]]}function a(t){return{kind:"constant",value:[.1,.1,.1,1]}}function s(t){if(!t.hasVisualVariables("size"))return{kind:"constant",value:[(0,r.Lz)(t.trailWidth)]};const e=t.getVisualVariablesForType("size")[0],n=[],o=[];let i;if(e.stops){for(const t of e.stops)n.push(t.value),o.push((0,r.Lz)(t.size));i=e.stops.length}else n.push(e.minDataValue,e.maxDataValue),o.push((0,r.Lz)(e.minSize),(0,r.Lz)(e.maxSize)),i=2;return{kind:"ramp",stops:n,values:o,count:i}}function u(t){if(!t.hasVisualVariables("color"))return{kind:"constant",value:l(t.color)};const e=t.getVisualVariablesForType("color")[0],n=[],r=[];for(const o of e.stops)n.push(o.value),Array.prototype.push.apply(r,l(o.color));return{kind:"ramp",stops:n,values:r,count:e.stops.length}}function c(t){if(!t.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const e=t.getVisualVariablesForType("opacity")[0],n=[],r=[];for(const o of e.stops)n.push(o.value),r.push(o.opacity);return{kind:"ramp",stops:n,values:r,count:e.stops.length}}function h(t,e,n,r){switch(e){case"int":t.setUniform1iv(n,r);break;case"float":t.setUniform1fv(n,r);break;case"vec2":t.setUniform2fv(n,r);break;case"vec3":t.setUniform3fv(n,r);break;case"vec4":t.setUniform4fv(n,r)}}function f(t,e,n,r){"constant"===r.kind?h(t,n,"u_".concat(e),r.value):(h(t,"float","u_".concat(e,"_stops"),r.stops),h(t,n,"u_".concat(e,"_values"),r.values),t.setUniform1i("u_".concat(e,"_count"),r.count))}function d(t,e){let n=!0;return n=n&&t.collisions===e.collisions,n=n&&t.density===e.density,n=n&&t.interpolate===e.interpolate,n=n&&t.lineCollisionWidth===e.lineCollisionWidth,n=n&&t.lineSpacing===e.lineSpacing,n=n&&t.maxTurnAngle===e.maxTurnAngle,n=n&&t.minSpeedThreshold===e.minSpeedThreshold,n=n&&t.segmentLength===e.segmentLength,n=n&&t.smoothing===e.smoothing,n=n&&t.velocityScale===e.velocityScale,n=n&&t.verticesPerLine===e.verticesPerLine,n}function p(t,e){return t===e||null!=t&&null!=e&&t.equals(e)}function m(t,e){if(!d(t.simulationSettings,e.simulationSettings))return!1;if(!p(t.timeExtent,e.timeExtent))return!1;let n=!0;return n=n&&t.loadImagery===e.loadImagery,n=n&&t.createFlowMesh===e.createFlowMesh,n=n&&t.color.kind===e.color.kind,n=n&&t.opacity.kind===e.opacity.kind,n=n&&t.size.kind===e.size.kind,n}},70667:(t,e,n)=>{n.d(e,{t:()=>g,z:()=>v});var r=n(19555),o=n(72745),i=n(55855),l=n(34111),a=n(482),s=n(44815),u=n(75002),c=n(38496),h=n(64465),f=n(50468),d=n(17345),p=n(66470),m=n(34017);function g(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const o=[],g=e.mapPositions;!function(t,e){const{attributeData:{position:n},removeDuplicateStartEnd:r}=t,o=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(n)&&r,i=n.length/3-(o?1:0),l=new Array(2*(i-1)),a=o?n.slice(0,-3):n;let s=0;for(let u=0;u<i-1;u++)l[s++]=u,l[s++]=u+1;e.push([p.r.POSITION,new f.n(a,l,3,o)])}(e,o);const v=o[0][1].data,_=o[0][1].indices.length,x=(0,c.EH)(_);return function(t,e,n){if(null!=t.attributeData.colorFeature)return;const r=t.attributeData.color;e.push([p.r.COLOR,new f.n(null!==r&&void 0!==r?r:i.Un,n,4)])}(e,o,x),function(t,e,n){var r;null==t.attributeData.sizeFeature&&e.push([p.r.SIZE,new f.n([null!==(r=t.attributeData.size)&&void 0!==r?r:1],n,1,!0)])}(e,o,x),function(t,e,n){t.attributeData.normal&&e.push([p.r.NORMAL,new f.n(t.attributeData.normal,n,3)])}(e,o,x),function(t,e,n){null!=t.attributeData.colorFeature&&e.push([p.r.COLORFEATUREATTRIBUTE,new f.n([t.attributeData.colorFeature],n,1,!0)])}(e,o,x),function(t,e,n){null!=t.attributeData.sizeFeature&&e.push([p.r.SIZEFEATUREATTRIBUTE,new f.n([t.attributeData.sizeFeature],n,1,!0)])}(e,o,x),function(t,e,n){null!=t.attributeData.opacityFeature&&e.push([p.r.OPACITYFEATUREATTRIBUTE,new f.n([t.attributeData.opacityFeature],n,1,!0)])}(e,o,x),function(t,e,n){if(null==t.overlayInfo||t.overlayInfo.renderCoordsHelper.viewingMode!==h.RT.Global||!t.overlayInfo.spatialReference.isGeographic)return;const o=(0,s.jh)(n.length),i=(0,l.tO)(t.overlayInfo.spatialReference);for(let r=0;r<o.length;r+=3)(0,a.RC)(n,r,o,r,i);const c=n.length/3,d=(0,u.oe)(c+1);let m=y,g=w,v=0,_=0;(0,r.hZ)(m,o[_++],o[_++]),_++,d[0]=0;for(let l=1;l<c+1;++l)l===c&&(_=0),(0,r.hZ)(g,o[_++],o[_++]),_++,v+=(0,r.xg)(m,g),d[l]=v,[m,g]=[g,m];e.push([p.r.DISTANCETOSTART,new f.n(d,e[0][1].indices,1,!0)])}(e,o,v),new d.V(t,o,g,m.d.Line,n)}const y=(0,o.vt)(),w=(0,o.vt)();function v(t,e){if(null==t||0===t.length)return[];const n=[];return t.forEach((t=>{const r=t.length,o=(0,s.jh)(3*r);t.forEach(((t,e)=>{o[3*e]=t[0],o[3*e+1]=t[1],o[3*e+2]=t[2]}));const i={attributeData:{position:o,normal:e},removeDuplicateStartEnd:!1};n.push(i)})),n}},74283:(t,e,n)=>{n.d(e,{A:()=>V});var r=n(35143),o=(n(81806),n(30726)),i=n(50346),l=n(68134),a=n(46053),s=(n(76460),n(47249),n(85842)),u=n(9956),c=n(2413),h=n(731),f=n(46533),d=n(66917),p=n(69576),m=n(9392),g=n(55855),y=n(12482),w=n(70667),v=n(425),_=n(46259);function x(t,e,n,r){const{spatialReference:o}=t;return function(t){const e=(0,w.z)(t),n=new v.W({width:2,color:(0,g.fA)(.1,.2,1,1),innerWidth:1,innerColor:(0,g.fA)(.2,.4,1,1),cap:_.x.ROUND});return e.map((t=>(0,w.t)(n,t)))}(n.map((n=>n.map((n=>{const[i,l]=function(t,e){let{x:n,y:r}=t;const{extent:o,size:[i,l]}=e;return[n/i*o.width+o.xmin,(l-r)/l*o.height+o.ymin]}(n,e),{absoluteZ:a}=(0,y.Q5)(i,l,0,o,t,r),s=(0,m.fA)(i,l,a);return t.renderCoordsHelper.toRenderCoords(s,o,s),s})))))}function b(t,e,n){let[r,o,i,l]=[null,null,null,null];for(e.reset(t);!e.done;){const t=e.next();if(null==t)continue;if(!t.visible){e.skipSubtree();continue}const a=t.extent;t.leaf&&t.rendered&&(0,c.HY)(a,n)&&(r=M(a[0],r),o=M(a[1],o),i=S(a[2],i),l=S(a[3],l))}return null==r||null==o||null==i||null==l?null:(0,c.vt)([r,o,i,l])}function S(t,e){return null==e?t:Math.max(t,e)}function M(t,e){return null==e?t:Math.min(t,e)}var A=n(91967),T=n(37046),D=n(44513),I=n(8918);class F{constructor(t,e){this.streamlines=t,this._geometries=e,this._object3D=null,this._engineLayer=null}get attached(){return null!=this._object3D&&null!=this._engineLayer}attach(t){const{_geometries:e}=this;if(null==e)return;this.detach();const n=new I.x(t,{pickable:!1,updatePolicy:D.q.SYNC}),r=new T.B({geometries:e});r.visible=!0,n.add(r),this._object3D=r,this._engineLayer=n}detach(){this.attached&&(this._engineLayer=(0,o.pR)(this._engineLayer),this._object3D=(0,o.WD)(this._object3D))}}let L=class extends A.A{constructor(t){super(t),this.simulationSettings=null,this.loadImagery=null,this.createGeometry=null}async load(t,e){const n=await this.loadImagery(t,e);if(null==n)return null;const r=this._createFlowFieldFromData(n),o=this._getStreamlines(t,r),i=this.createGeometry(t,o);return new F(o,i)}_createFlowFieldFromData(t){return(0,f.DE)(this.simulationSettings,t)}_getStreamlines(t,e){const{size:[n,r]}=t;return(0,f.qH)(this.simulationSettings,e,n,r)}};(0,r._)([(0,a.MZ)()],L.prototype,"simulationSettings",void 0),(0,r._)([(0,a.MZ)()],L.prototype,"loadImagery",void 0),(0,r._)([(0,a.MZ)()],L.prototype,"createGeometry",void 0),L=(0,r._)([(0,s.$)("esri.views.3d.support.flow.StreamlinesStyle3D")],L);var k=n(9902);let V=class extends p.A{constructor(t){super(t),this.type="flow",this._preorderIterator=new k.C2,this._abortController=null,this._debouncedLoad=(0,i.sg)((async()=>{var t;const{view:e,_style:n}=this;if(null==n)return;const r=this._computeExtent();if(null==r)return;const o={extent:r,timeExtent:this.layer.timeExtent,size:this._viewSizeWithEqualRatio(r),pixelRatio:e.state.contentPixelRatio};null==this._abortController&&(this._abortController=new AbortController);const l=this._abortController,a=await n.load(o,l.signal);(0,i.Te)(l.signal),null!=a&&(null!==(t=this._resources)&&void 0!==t&&t.detach(),a.attach(e.stage),this._resources=a)})),this._loadImagery=(t,e)=>{const{extent:n,size:[r,o],timeExtent:i}=t;return(0,f.pH)(this.layer,n,r,o,i,e)},this._createFlowGeometry=(t,e)=>x(this.view,t,e,this.elevationInfo)}initialize(){this.addHandles([(0,l.z7)((()=>this.newStyleRequired),(()=>this._updateStyle()),l.OH)]),this.updatingHandles.add((()=>this._style),(()=>this._triggerLoad())),this._updateStyle(),this.updatingHandles.addWhen((()=>{var t;return!(null!==(t=this.view.basemapTerrain)&&void 0!==t&&t.updating)}),(()=>this._triggerLoad()))}destroy(){this._abortController=(0,o.DC)(this._abortController),this.clear()}get layer(){return this.layerView.layer}get flowRenderer(){const t=this.layer.renderer;return"flow"!==(null===t||void 0===t?void 0:t.type)?null:t}get elevationInfo(){return new h.A({mode:"absolute-height",offset:1e3})}get dataBounds(){const{fullExtent:t}=this.layer,{spatialReference:e}=this.view.basemapTerrain,n=(0,u.projectOrLoad)(t,e).geometry;return null==n?null:(0,c.VY)(n)}get simulationSettings(){const{flowRenderer:t}=this;return null==t?null:(0,d.hq)(t)}get newStyleRequired(){var t;const e=null===(t=this._style)||void 0===t?void 0:t.simulationSettings,n=this.simulationSettings;return null!=e&&null!=n&&!(0,d.r$)(e,n)}doRefresh(){return this._triggerLoad()}clear(){var t;null!==(t=this._resources)&&void 0!==t&&t.detach(),this._resources=null}_triggerLoad(){return(0,i.QZ)(this.updatingHandles.addPromise(this._debouncedLoad()))}_updateStyle(){var t;const{simulationSettings:e}=this;null!=e&&(null!==(t=this._style)&&void 0!==t&&t.destroy(),this._style=new L({simulationSettings:e,loadImagery:this._loadImagery,createGeometry:this._createFlowGeometry}))}_computeExtent(){const t=this.view.basemapTerrain,e=null===t||void 0===t?void 0:t.rootTiles;if(null==e||0===e.length)return null;const{spatialReference:n}=t,{dataBounds:r}=this;if(!n||null==r)return null;const o=b(e,this._preorderIterator,r);return null==o?null:((0,c.E$)(o,r,o),(0,c.w1)(o,n))}_viewSizeWithEqualRatio(t){const e=(t.xmax-t.xmin)/(t.ymax-t.ymin),[n,r]=this.view.size;return n<r?[n,Math.floor(n/e)]:[Math.floor(r*e),r]}get test(){}};(0,r._)([(0,a.MZ)()],V.prototype,"type",void 0),(0,r._)([(0,a.MZ)()],V.prototype,"_style",void 0),(0,r._)([(0,a.MZ)()],V.prototype,"layer",null),(0,r._)([(0,a.MZ)()],V.prototype,"flowRenderer",null),(0,r._)([(0,a.MZ)()],V.prototype,"elevationInfo",null),(0,r._)([(0,a.MZ)()],V.prototype,"dataBounds",null),(0,r._)([(0,a.MZ)()],V.prototype,"simulationSettings",null),(0,r._)([(0,a.MZ)()],V.prototype,"newStyleRequired",null),V=(0,r._)([(0,s.$)("esri.views.3d.layers.FlowSubView3D")],V)}}]);
//# sourceMappingURL=78572.d8b79fa9.chunk.js.map